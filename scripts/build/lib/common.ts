import { execSync } from "node:child_process";
import { resolve } from "node:path";

const mdNoteFlavors = {
    jsts: ["/*", "*/"],
    md: ["<!--", "-->"],
};

export const makeMdNote = (
    file: string,
    flavor: keyof typeof mdNoteFlavors,
) => `${mdNoteFlavors[flavor][0]}
    * This file was autogenerated, do not modify it directly
    * https://github.com/nexpid/RevengePlugins/tree/dev/${file}
${mdNoteFlavors[flavor][1]}`;

export const branch: string = execSync("git branch --show-current")
    .toString()
    .trim();

export const isDev =
    process.argv.includes("--dev") ||
    process.argv[1] === resolve("scripts/watch/index.ts");

export const previewLang =
    isDev &&
    (process.argv.includes("-pl") || process.argv.includes("--preview-lang"));

export const prettierOptions: import("prettier").Options = {
    // .editorconfig isn't properly parsed by prettier, so I have to write
    // the rules myself here manually
    endOfLine: "lf",
    tabWidth: 4,
    printWidth: 80,
    bracketSameLine: true,
    arrowParens: "avoid",
};

export const markdownPrettierOptions: import("prettier").Options = {
    ...prettierOptions,
    tabWidth: 2,
};

export const plural = (count: number, singular: string, plural: string) =>
    count === 1 ? singular : plural;
